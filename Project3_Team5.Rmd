---
title: "Can Imposing Strict Law Reduce the Traffic Fatality"
author: "STA 207 Project 3"
date: "Feb 14, 2020"
geometry: "left=0.8in,right=0.8in,top=0.8in,bottom=0.8in"
output:
  pdf_document: default
  html_document:
    df_print: paged
    fig_caption: yes
    number_sections: yes
---

<style type="text/css">

body{ /* Normal  */
      font-size: 18px;
  }

</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE,message=FALSE,warning=FALSE,fig.align = 'center',out.width = '\\textwidth', out.extra = '', fig.pos = 'h')
```

***
Group ID: 5\
Libin Feng: Summary(minor), Introduction, Modelling, RMD Formatting, Visualization\
Miao Hu: FEM, Output, Diagnostics, RMD Formatting\
Huachao Lin: Visualization, policy suggestions, model diagnostics\
Roger Zhou: PSM, Causal Inference, Conclusion, Wordings and Logics\
Github repo link: https://github.com/miaohu2019/STA-Project-3

***

\pagebreak


```{r}

library(MatchIt)
library(dplyr)
library(ggplot2)
library(AER)
library(plotly)
data("Fatalities")

```

# INTRODUCTION
## Background 

Traffic fatalities are a major source of accidental deaths, and driving under the influence (DUI) constitutes a big share. Over the past few decades, state governments established strict laws on alcohol-involved driving to reduce the death rate. Christopher Ruhm discovered the significant effect of beer tax on fatality rates using a fixed-effect model, and suggested steep tax on beer (Ruhm 1996). However, the relationship between punitive measures, including mandatory jail sentences and community service upon the first violation of DUI-related laws, and fatality rates was inconsistent under different models and assumptions. Whether imposing strict laws can effectively regulate the drivers’ behavior remains a big question. 

## Questions of Interest
Is there any effect of the mandatory jail sentences on the reduction of traffic fatality rate? \
What would be an appropriate model for our purposes? Are the model assumptions satisfied?\
If the effect is significant, can we interpret it as a causal effect? What policy recommendations can we make?


# STATISTICAL ANALYSIS
## Exploratory Data Analysis


```{r fig.width= 5, fig.height= 5, fig.cap= 'Correlation Coefficient Matrix of Selected Variables' }
# Heatmap
Fatalities$frate <- with(Fatalities, fatal/pop * 10000)
Fatalities3 <- Fatalities
# data processing
Fatalities3[28,'jail'] = Fatalities3[27,'jail']
Fatalities3[28,'service'] = Fatalities3[27,'service']


Fatalities3$jail1 = as.numeric(Fatalities3$jail)-1
Fatalities3$jail1 = as.numeric(Fatalities3$jail)-1

x1 = cor(Fatalities3[,c(3:13,17:19, 31:35)])
x1[upper.tri(x1,diag = TRUE)] <- NA
x1 = round(x1,1)

library(reshape2)
melted_cormat <- melt(x1, na.rm = TRUE)

library(ggplot2)
ggplot(data = melted_cormat, aes(Var2, Var1, fill = value))+
  geom_tile(color = "white")+
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab", 
                       name="Pearson\nCorrelation") +
  theme_minimal()+ 
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 8, hjust = 1))+
  coord_fixed() + 
  geom_text(aes(Var2, Var1, label = value), color = "black", size = 1.5) +
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.grid.major = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    #legend.justification = c(1, 0),
    legend.position = c(0.6, 0.3),
    legend.direction = "horizontal" ) +
  guides(fill = guide_colorbar(barwidth = 7, barheight = 1,
                               title.position = "top", title.hjust = 0.5))


```

The dataset studied is observational panel data at the state level on US traffic fatalities from 1982-1988. 48 states were observed once every year. Other variables include various fatalities, macroeconomics status, regulations, penalties, and demographics. Since all fatality variables were almost perfectly collinear with each other, we will use total traffic fatalities rate as our basis variable for the response. To account for the difference in the population across different states, a normalized variable, fatalities rate, is generated by dividing the total fatalities by the population measured in 10,000 units and will be treated as the response variable in our analysis. \

The indicator of the mandatory jail sentence and community service at the first offense for California is missing values in the year of 1988. We have filled them based on the 1989 version of the document, $\textit{Digest of State Alcohol-Highway Safety Related Legislation}$, by NHTSA, making it a balanced panel. Among the 48 states, 9 had mandatory jail sentences in place throughout, 33 did not have such regulation, and 5 states (NV, SC, UT, OR, CT) enacted such enforcement during this period. It is also worth noting that Ohio started enforcing the jail sentence in 1983 but terminated it in 1987. Our objective is to draw causal inference from the latter 6 states. \

Since it was mentioned by Yakovlev et al. that the unemployment rate and income are significantly correlated with fatal rate, we will explore these two variables in our project along with the jail sentence indicator. The correlation matrix plot (Figure 1) also confirms the correlation between fatality rate and per capita income. \

The distribution of all fatality rates (Figure 2 Left) is roughly bell shaped with a few extreme values on the right tail. Meanwhile, the average fatality rate appears higher for observations with mandatory sentence to jail (mean = 2.29) than those without such policy (mean = 1.94). This is an unusual finding since one would intuitively expect the policy to reduce the fatality rates. \

```{r fig.width= 6, fig.height=3, fig.cap = 'Distribution of all fatality rates (Left), Boxplot of Fatality Rates across Different Jail Policies (Right)'}
#Explore the data
par(mfrow = c(1,2))
fatal_data = Fatalities %>%
  select(fatal, pop, jail, unemp, state, year, income) %>%
  mutate(fatal_rate=fatal / pop * 10000)
fatal_data[28,'jail'] = fatal_data[27,'jail']

hist(fatal_data$fatal_rate,main = '', xlab = 'fatalities/10K', breaks = 30,cex.axis = .6,cex.names = .6)
boxplot(fatal_rate ~ jail,data=fatal_data, 
        #main = 'Boxplot of Jail Sentence Status vs. Fatal Rate',
        xlab = 'Is Jail Mandatory?', ylab = 'fatalities/10K', cex.axis = .6,cex.names = .6)

```

* Temporal Effect: As shown in Figure 3, the fatality rates for all states fluctuate arbitrarily and do not share a common pattern. As for the aforementioned 6 special states, fatality rates did not move in the same direction after the change of the jail policy. \

```{r,include = FALSE}
# Figure 2
library(panelView)
x3 <- panelView(frate ~ jail1 + beertax, data = Fatalities3, index = c("state","year"),
                type = "outcome", main = "",xlab = "Year", ylab = "Fatalities per 10K",by.group = FALSE, 
                color = c('red','black'), cex.main = 1, cex.main.sub = 12, 
                legend.labs = c("No mandatory Jail","Jail"))

x2 <- panelView(frate ~ jail1 + beertax, data = Fatalities3, 
                index = c("state","year"),type = "outcome",
                main = "",xlab = "Year", ylab = "Fatalities Rate", legend.labs = c("No Mandatory Jail", "Jail"),id=c('nv','sc','ut','oh','or','ct'), color = c('red','black'))

```

```{r fig.height = 3,fig.width = 5, fig.cap = "Fatality Rates Over Time of All States Over Jail Sentence Policy, without (left, 42 States) and with Policy Change (Right, 6 States)"}
gridExtra::grid.arrange(x3,x2,ncol=2)
```


* Spatial Effects: Spatial-correlation is very likely to exist in neighboring states with similar commuting patterns. For example, the fatality rates of New York state are almost surely correlated with those of New Jersey state. Limited by time and knowledge, we will not rigorously investigate the existence of spatial correlations between the states. However, heterogeneities can be absorbed by modeling. \

## Regression Discontinuity Design
Following the above discovery, since 6 states experienced a change in the law of jail imprisonment for DUI cases during 1982-1988, we adopt a regression discontinuity design (RDD) approach in order to identify significant causal impact of the mandatory jail sentence on the traffic fatalities. The motivation behind this approach lies in the empirical value of these 6 states that genuinely implemented the regulation. The regression discontinuity essentially allows us to construct a quasi-experimental design from the observational data where the new policy can be thought of as randomly assigned. Immediately before and after the law, these 6 states are studied ceteris paribus (i.e. holding other factors constant). Hence, the change in the fatalities rates can be interpreted as the (local) average treatment effect. \

### Model Specification
While it is widely the case in the literature that a bandwidth of several time periods is used for the RDD (Lalive 2007), we will only consider 2 time periods, the year before the implementation of jail sentence associated with DUI and the year after, confined by the availability of data. Following is the simple local linear regression model that we will estimate:

$$Y_{it}=\alpha+\gamma\,\cdot\,D_{it}+\epsilon_{it}\,,\,\forall i=1,\cdots,6;\,t=1,2$$

Here, $Y_{it}$ denotes the fatality rate of state $i$ at time $t$; $\alpha$ is the average fatality rates for all 6 states prior to the law; the dummy variable $D_{it}$ takes 1 if $t=2$, and 0 otherwise; and lastly, error terms $\epsilon_{it}\sim N(0,\sigma^2)$. Based on this model, the estimate of the coefficient $\gamma$ will be the average treatment effect of the jail sentence law. Contrast studies with randomized controlled trials have shown that RDD has high internal validity (Chaplin et al. 2018). 

### Model Estimates
We are aware of some drawbacks of the RDD approach. In particular, RDD only returns local treatment effect, hence low external validity. This means that we cannot generally extrapolate the results to other settings unless we conduct further analysis with more data. However, given the limited time span and available data, this is the most reasonable approach we have decided to adopt for our ex-post analysis. The table below reports the estimated results.

\pagebreak

```{r fig.cap = 'Model Estimates'}
## Examine the Jail-sentence Policy ##
table1 <- aggregate(Fatalities3$jail,by = list(Fatalities3$state), table)
# 6 states experienced the change in the jail-sentence policy during the period of time studied
#### Estimating Treatment Effect with 6 States ####
six_states <- as.character(table1[which(table1$x[,1] != 0 & table1$x[,1] != 7),1])

data_6_states <- Fatalities3[Fatalities3$state %in% six_states, ]
data_6_states <- data_6_states[-which(data_6_states$state == "oh")[6:7], ]

group0 <- data_6_states[data_6_states$jail == "no", ]
group1 <- data_6_states[data_6_states$jail == "yes", ]
frate6_avg <- rbind(aggregate(group0$frate, list(group0$state), mean), 
                    aggregate(group1$frate, list(group1$state), mean))
frate6_avg <- cbind(frate6_avg, c(rep("no", 6), rep("yes", 6)))

names(frate6_avg) <- c("state", "avg_frate", "jail")
rdd <- lm(avg_frate~jail, data = frate6_avg)
summary1 = summary(rdd)
sum1 = as.table(round(summary1$coefficients,3))
rownames(sum1)[2] <- 'jail'
knitr::kable(sum1)

```


We can see that the average treatment effect of jail sentence, i.e. the coefficient estimate for the jail variable, is not statistically significant. We suspect that this is due to a spectrum of reasons, and we will provide more details in the discussion section below.



* $\textbf{Continuously Measured Outcome:}$ RDD requires that the outcome is continuously measured around the cutoff (i.e. reception of treatment). Since the fatality rates are continuously defined in all years, we know this assumption is met. \

* $\textbf{Randomness in the Treatment:}$ Either there is randomness in the assignment of the treatment or the treated subjects have no control on the outcomes. Since the states cannot control the number of traffic deaths in any ethical manner, this assumption also holds. \

Next, we will use the residual plots approach to examine the assumptions of the linear model.

* $\textbf{Normality:}$ While the pattern is weak as a result of small sample size, the Normal Q-Q plot (Figure in appendix) does not show a massive deviation from normal distribution. We believe the normality assumption of the error terms roughly holds.

* $\textbf{Homoscedasticity:}$ Likewise, the data points appear to be evenly dispersed in the Residual-vs-Fitted-Values plot. We do not have strong evidence against the homoscedasticity assumption.

* $\textbf{Independence:}$ 3 of the 6 states border each other, whereas the other 3 are remotely located. We believe that the commute was much less intensive in the 80s than today, especially in mountainous states like Oregon, Nevada, and Utah. Hence, the spatial-correlation is negligible, if any. Moreover, the nature of RDD implies that the temporal-correlation is also very marginal in 2 adjacent years. Therefore, while not rigorous, we conclude that the independence assumption holds. 



## Fixed Effects Model

After studying the causal impact of the jail sentence in the 6 states mentioned above, we will examine the potential treatment effects from other covariates in the data set. Multiple literatures have suggested that a two-way fixed effect model can be used to estimate treatment effects on this panel data (de Chaisemartin 2019; Kropko 2018; Yakovlev 2010). \

To determine the most relevant variables when constructing the model, we referred to the literature that investigated the same data set. Most papers found that economic indicators such as per-capita income and unemployment rate have significant relationship with death rates. Thus, we will include both variables alongside the jail sentence status in our model (Hanck 2019).\

### Model Specification

Although each paper proposes its own models, we have adopted the model by Paul D. Allison for its simplicity and high interpretability. The model is specified as follows (Allison 2009).

$$y_{it} = \alpha_i + X \beta + \mu_t + \epsilon_{it}$$

where $y_{it}$ is the response of individual fatality rate $i$ observed at time $t$; $\alpha_i$ represents the time constant individual effect; $\mu_t$ represents the time varying effect; and $\beta$ is the vector of coefficients. $X$ denotes the collection of input variables including per capita personal income, unemployment rate, and mandatory jail sentence status. Finally, $\epsilon_{it}$ are the error terms.

### Model Estimates
The estimated coefficients are $7.2 \times 10^{-5}$ for income, $-7.8615 \times 10^{-2}$ for unemployment rate, and $2.0526 \times 10^{-2}$ for the jail status. Per capita income is positively related to the fatality rate, while the unemployment rate is negatively related to the fatality rate. Having mandatory jail sentences appears to increase fatality rate on average although insignificantly, when other factors are held constant. 

### Model Diagnostics  
```{r fig.width= 7, fig.height=2.5, fig.cap='Model Diagnostics: Normal Q-Q Plot (Left), Residuals vs. Fitted Plot (Right)'}
# boxplot(unemp ~ jail,data=fatal_data, main = "unemployment")
Fatalities$jail1 = as.numeric(fatal_data$jail)-1
Fatalities1 = Fatalities[Fatalities$state == 'nv'|Fatalities$state == 'sc'|Fatalities$state == 'ut'|Fatalities$state == 'oh'|
                           Fatalities$state == 'or'|Fatalities$state == 'ct',]

Fatalities$frate = fatal_data$fatal_rate


# Only 6 states changed status

Fatalities1$frate = Fatalities1$fatal/Fatalities1$pop * 10000


# Model building
fatal_data$jail1 = Fatalities$jail1
library(plm)
re = plm( fatal_rate ~ income + unemp +jail1, data = fatal_data, model = "within",
          effect = "twoways", index = c('state', 'year'))
# summary(re)

# get fitted values
X.new = as.matrix(select(fatal_data, income, unemp, jail1))
coe = as.matrix(coef(re))
preds = X.new %*% coe


# Model dignose
par(mfrow = c(1,2))
# Normality
qqnorm(re$residuals, main = '',cex=0.5,cex.axis = .6,cex.names = .6)
qqline(re$residuals)
# Constant Variance
plot(preds, residuals(re),ylab = 'residuals',xlab = 'predicted', cex=0.5,cex.axis = .6,cex.names = .6)
```
According to the book, $\textit{Statistics: An Introduction Using R}$ by Michael J. Crawley, there are two crucial assumptions of the fixed-effects model for panel data, constant variance and normally distributed errors (Crawley 2005). To examine these two assumptions, we plot the Normal Q-Q plot and the residuals vs. fitted values plot presented below. \

* $\textbf{Normality:}$ The Normal Q-Q plot shows more probabilities on both tails, implying a heavy-tailed distribution. In this model, since not all factors are considered, under-identification might have led to the omitted variable bias. This will make our inference less conservative, potentially undermining the results. Regretfully, we have not yet identified an effective way to tackle this issue. \


* $\textbf{Homoscedasticity:}$ The Residual vs. Fitted Value plot shows no obvious trend of the data, indicating that the constant variance assumption holds for the proposed model. \

* $\textbf{Independence:}$ Although the independence assumption can be very important in linear models. We realize that our data fails to satisfy this assumption by its intrinsic characteristics (e.g. geographical adjacency). Restricted by the limited time and knowledge, future research is appropriate in order to resolve this issue. \


### HYPOTHESIS TESTS
We will perform a test on the coefficient of jail sentence law to investigate whether it has significant effects on the fatality rates. The hypothesis and results are summarized below:

$H_{0}$: The coefficient of jail status equals 0 vs. $H_{a}$: The coefficient of jail status does not equal 0
We would reject $H_0$ if p-value$<0.05$. Since the p-value is 0.74 (F-statistics = 0.11), we fail to reject the null hypothesis at any conventional significance levels. Therefore, we conclude that the jail sentence law does not have any significant effect on the fatality rates.

# CAUSAL INFERENCE
In performing the regression discontinuity design, we have found that the average impact of having the mandatory imprisonment due to DUI is not statistically significant. We have proposed the following reasons that might have contributed to the absence of causal effect of the jail sentence law. \

* One of the most likely determinants is the small sample size. With only 6 states on record that underwent the implementation of the new law, the variance is very large relative to the magnitude of the effect from the law. Even though we could not find any additional data, it is reasonable to expect that with more data on states going from no law to having the imprisonment law, the estimate would become more precise and the effect would manifest itself more. \

* Furthermore, it is also likely that psychologically, people overreacted to the new jail sentence by driving even faster to avoid being caught and disobeying the traffic rules even more badly. This theory is supported by the data where some states actually witnessed an increase in the fatalities rates after the law came into being, and this effect in turn more than offset the positive reduction from the law, leaving the overall effect ambiguous. \

* Similarly, the extent to which the new law was successfully executed is also beyond the available data to us. It is practically hard for the highway patrols and other police officials to maintain constant surveillance on the behavior of the drivers. Therefore, even with the law in place, its desired effects could be very obscure. \


# CONCLUSION
Overall, how the jail sentence on first conviction caused the fatality rates to change is unclear based on our analysis. Although one would conjecture that having strict laws regulates drivers’ behavior through fear or other means, current data does not support this idea.
Based on the fixed-effects model, we also found that the jail sentence status is not significantly correlated with the fatality rate. In comparison, the economic factors such as income and unemployment rate are significantly correlated with the fatality rate, which is consistent with former studies. We also realize that there exists omitted-variable bias (OVB) in our fixed effect model due to the possibility that our model might leave out one or more relevant variables, and our inference might be imprecise as a result.  

* $\textbf{Policy Implication:}$ In order to establish laws that lower traffic deaths with higher chances, it is recommended that more systematic experiments, such as randomized controlled trials (RCTs), be conducted on a wider range of factors affecting drivers’ ability behind the wheel. For example, the government should consider conducting RCTs at the county or city level in a completely random selection of areas. Only in doing so can we confidently enhance the safety for all that travel on the road. 

\pagebreak

# REFERENCE

Allison, Paul D. $\textit{Fixed effects regression models.}$ Vol. 160. SAGE publications, 2009.
Chaplin, Duncan D.; Cook, Thomas D.; Zurovac, Jelena; Coopersmith, Jared S.; Finucane, Mariel M.; Vollmer, Lauren N.; Morris, Rebecca E. (2018). "The Internal and External Validity of the Regression Discontinuity Design: A Meta-Analysis of 15 Within-Study Comparisons". Journal of Policy Analysis and Management. \
de Chaisemartin, Clément, and Xavier d'Haultfoeuille.  $\textit{Two-way fixed effects estimators with heterogeneous}$ \newline $\textit {treatment effects.}$ No. w25904. National Bureau of Economic Research, 2019. \
Crawley, Michael J. $\textit{An introduction using R.}$ Á Wiley (2005). \
Hanck, Christoph, et al. $\textit{Introduction to Econometrics with R.}$ Essen: University of Duisburg-Essen.[Google Scholar] (2019). \
Kropko, Jonathan, and Robert Kubinec. $\textit{Why the two-way fixed effects model is difficult to interpret, and what to do about it.}$ Available at SSRN 3062619 (2018). \
Lalive, R. 2007. $\textit{Unemployment Benefits, Unemployment Duration, and Post-Unemployment Jobs A Regression}$ \newline $\textit{Discontinuity Approach}$. Journal of Economic Literature. \
Ruhm, C. J. 1996. $\textit{Alcohol Policies and Highway Vehicle Fatalities}$. Journal of Health Economics. \
Yakovlev, P. A., and Inden, M. 2010. $\textit{Mind the Weather: A Panel Data Analysis of Time-Invariant Factors}$ \newline $\textit{and Traffic Fatalities.}$ Economics Bulletin. \


# APPENDIX

## Graphs

```{r fig.height=2.5 , fig.width= 6.5, fig.cap= 'RDD Model Diagnostics'}
# Model Diagnostics
par(mfrow=c(1,3))
plot(rdd,which=1:2)
hist(rdd$residuals,breaks=8,main = '')
```

```{r fig.cap= 'Law Change For Six States', fig.width=5,fig.height=5, include = FALSE}
library(panelView)
panelView(frate ~ jail1 + beertax, data = Fatalities3, 
          index = c("state","year"), xlab = "Year", 
          ylab = "State", legend.labs = c("No Mandatory Jail", "Jail"), 
          background = "white", cex.main = 20, cex.axis= 8, cex.lab = 12, 
          cex.legend = 12,id=c('nv','sc','ut','oh','or','ct'),main = '')

```

\pagebreak


## Outputs
```{r}
# Hypothesis testing

red3 =  plm( fatal_rate ~ income +unemp, data = fatal_data, model = "within",
             effect = "twoways", index = c('state', 'year')) 
pFtest(re,red3)

```

```{r}
summary(re)
```

\pagebreak
# Session Information

```{r}
print(sessionInfo(), local = FALSE)
```


